(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3662:(e,t,n)=>{Promise.resolve().then(n.bind(n,5288))},5288:(e,t,n)=>{"use strict";n.d(t,{default:()=>r});var l=n(2860),o=n(3200);let i=(e,t,n)=>{for(let[l,o]of[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]]){let i=e+l,r=t+o;if(i>=0&&i<5&&r>=0&&r<4&&"tiger"===n[i][r].content)return!0}return!1},r=()=>{let e=()=>[,,,,,].fill(null).map((e,t)=>[,,,,].fill(null).map((e,n)=>({id:4*t+n,content:null,isFertile:!0,owner:null,isDecaying:!1}))),[t,n]=(0,o.useState)({grid:e(),oxygenLevel:0,plantCount:0,humanCount:0,tigerCount:0,woodCount:0,currentLevel:1,timeLeft:120,messages:["欢迎来到生态保护游戏！"],isGameOver:!1}),[r,a]=(0,o.useState)(null),[s,c]=(0,o.useState)([]),[d,u]=(0,o.useState)([]),f=(0,o.useCallback)(e=>{n(t=>({...t,messages:[...t.messages.slice(-5),e]}))},[]),g=(0,o.useCallback)((e,t)=>{let n=t;if(e.flat().filter(e=>"fire"===e.content).length>=2){for(let t=0;t<5;t++)for(let l=0;l<4;l++)if("tiger"===e[t][l].content){let o=0;for(let[n,i]of[[-1,0],[1,0],[0,-1],[0,1]]){let r=t+n,a=l+i;r>=0&&r<5&&a>=0&&a<4&&"fire"===e[r][a].content&&o++}if(o>=2)return e[t][l].content="tiger-dead",e[t][l].isDecaying=!0,n+=" 两团火的热量消灭了一只老虎！"}}return n},[]),x=(0,o.useCallback)(e=>{let t=0,l=0,o=0,i=0,r=0;e.flat().forEach(e=>{"plant"===e.content&&(t++,r+=e.isFertile?10:1),("human"===e.content||"human"===e.owner)&&l++,"tiger"===e.content&&o++,"wood"===e.content&&i++}),r-=5*l,r=Math.max(0,Math.min(100,r)),n(n=>({...n,plantCount:t,humanCount:l,tigerCount:o,woodCount:i,oxygenLevel:r,grid:e}))},[]);(0,o.useEffect)(()=>{let e=t.grid.map(e=>e.map(e=>({...e}))),n=[],l=!1,o=!1;e.flat().forEach(i=>{let r=Math.floor(i.id/4),a=i.id%4;if("human"===i.content)t.oxygenLevel<20?(n.push("氧气浓度低于20%，人类窒息而亡！"),e[r][a].content="human-dead",e[r][a].isDecaying=!0,l=!0):t.oxygenLevel>30&&(n.push("氧气浓度高于30%，人类因含氧量超标死亡！"),e[r][a].content="human-dead",e[r][a].isDecaying=!0,l=!0);else if(("human-dead"===i.content||"tiger-dead"===i.content)&&i.isDecaying){let t="human-dead"===i.content?"骸骨":"老虎残骸";e[r][a].content=null,e[r][a].isDecaying=!1,l=!0,o||(n.push("一具".concat(t,"风化消失了。")),o=!0)}}),n.length>0&&n.forEach(e=>f(e)),l&&x(e)},[t.oxygenLevel,t.plantCount,t.grid,f,x]),(0,o.useEffect)(()=>{let e;if(3===t.currentLevel&&t.timeLeft>0&&!t.isGameOver)e=setInterval(()=>{n(e=>({...e,timeLeft:e.timeLeft-1}))},1e3);else if(3===t.currentLevel&&0===t.timeLeft&&!t.isGameOver){f("120秒到！持续强降雨，引发大洪水！");let e=t.grid.map(e=>e.map(e=>"fire"!==e.content?{...e,content:null,owner:null,isFertile:!1,isDecaying:!1}:{...e,isFertile:!0}));n(t=>({...t,grid:e,messages:[...t.messages.slice(-5),"洪水退去，土地贫瘠。尝试用火制造草木灰恢复地力吧！"],woodCount:0})),x(e)}return()=>clearInterval(e)},[t.currentLevel,t.timeLeft,t.isGameOver,f,x,t.grid]);let h=()=>{c(e=>[...e,JSON.parse(JSON.stringify(t))])},m=(e,n)=>{h();let l=t.grid.map(e=>e.map(e=>({...e}))),o=l[e][n],s="";if(r){if(null===o.content){if("plant"===r)o.isFertile?(o.content="plant",s="放置了 植物",a(null)):s="土地贫瘠，植物无法生长！请先用火制造草木灰恢复地力。";else if("human"===r){if(s="放置了 人",t.oxygenLevel<20)s="环境中氧气浓度低于20%，人类窒息而亡！",o.content="human-dead",o.isDecaying=!0;else if(t.oxygenLevel>30)s="环境中氧气浓度高于30%，人类因含氧量超标死亡！",o.content="human-dead",o.isDecaying=!0;else if(o.content="human",i(e,n,l))s+=", 附近有老虎威胁，暂时不消耗植物。";else{let e=l.flat().filter(e=>"plant"===e.content);if(e.length>0){let t=e[Math.floor(Math.random()*e.length)];l[Math.floor(t.id/4)][t.id%4].content="plant-dead",s+=", 消耗了一株植物。"}else s+=", 但没有植物可消耗。"}a(null)}else"tiger"===r&&(o.content="tiger",s="放置了 老虎",a(null))}else"human"===r&&"house"===o.content&&null===o.owner?(o.owner="human",s="人住进了房子！",a(null)):s="这个格子已经被占用了或操作无效！"}else if("plant"===o.content)i(e,n,l)?(o.content="fire",s="植物在老虎的威胁下被点燃了！",3!==t.currentLevel||o.isFertile||0!==t.timeLeft||(o.isFertile=!0,s+=" 草木灰增加了土壤肥力！"),s=g(l,s)):t.currentLevel>=2?(o.content="wood",s="植物变成了木头！收集4块木头可以建造房子。"):s="点击植物。在第二关及以后，植物可以转化为木头。";else if("wood"===o.content&&t.currentLevel>=2){let e=o.id;if(!d.includes(e)){let t=[...d,e];if(u(t),s="选择了木头 (".concat(t.length,"/4)。"),4===t.length){let e=!1;for(let n=0;n<5;n++){for(let o=0;o<4;o++)if(null===l[n][o].content){l[n][o].content="house",s="4块木头合成了一座房子！",t.forEach(e=>{l[Math.floor(e/4)][e%4].content=null}),e=!0;break}if(e)break}e||(s="没有空地建造房子！"),u([])}}}else"plant-dead"===o.content?(s="枯叶被点燃！",3!==t.currentLevel||o.isFertile||0!==t.timeLeft?(o.content="fire",s+=" 变成了火！",3!==t.currentLevel||o.isFertile||(o.isFertile=!0,s+=" 草木灰增加了土壤肥力！"),s=g(l,s)):(o.content=null,o.isFertile=!0,s+=" 草木灰增加了土壤肥力！现在可以在这块土地上种植了。")):s="请先选择一个物品，或点击植物/枯叶进行转化。";s&&f(s);let c=!1;if(t.currentLevel>=2){let e=l.map(e=>e.map(e=>({...e})));for(let t=0;t<5;t++){for(let n=0;n<4;n++)if("tiger"===e[t][n].content){let l=!1;for(let[o,i]of[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]]){let r=t+o,a=n+i;if(r>=0&&r<5&&a>=0&&a<4){let o=e[r][a];if("human"===o.content&&!("human"===o.owner&&"house"===e[r][a].content)){e[r][a].content="human-dead",e[r][a].isDecaying=!0,f("老虎在(".concat(t+1,",").concat(n+1,")吃掉了(").concat(r+1,",").concat(a+1,")的人！")),c=!0,l=!0;break}}}if(l)break}if(c)break}if(c){x(e);return}}x(l)},p=e=>{a(e),u([]),f("选择了 ".concat("plant"===e?"植物":"human"===e?"人":"老虎"))},y=e=>"plant"===e.content?"\uD83C\uDF3F":"plant-dead"===e.content?"\uD83C\uDF42":"human"===e.content?"\uD83E\uDDD1":"human-dead"===e.content?"\uD83D\uDC80":"tiger"===e.content?"\uD83D\uDC05":"tiger-dead"===e.content?"☠️":"fire"===e.content?"\uD83D\uDD25":"wood"===e.content?d.includes(e.id)?"\uD83E\uDEB5✨":"\uD83E\uDEB5":"house"===e.content?"human"===e.owner?"\uD83C\uDFE0\uD83E\uDDD1":"\uD83C\uDFE0":"",v={border:"1px solid #a5d6a7",backgroundColor:"#D2B48C",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2.5em",cursor:"pointer",transition:"background-color 0.3s ease, transform 0.1s ease",borderRadius:"4px"},b={padding:"10px 15px",fontSize:"1em",cursor:"pointer",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"5px",margin:"5px"},C={margin:"5px 0",fontSize:"0.9em",color:"black"},L={color:"black",marginTop:"15px",flexShrink:0},w={textAlign:"center",color:t.timeLeft<10?"red":t.timeLeft<60?"#f57c00":"black",marginTop:"0",marginBottom:"10px",flexShrink:0};return(0,l.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",width:"100vw",padding:"0px",margin:"0px",boxSizing:"border-box",backgroundColor:"#001f3f"},children:(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"row",backgroundColor:"#e0f2f1",padding:"20px",borderRadius:"10px",boxShadow:"0 4px 8px rgba(0,0,0,0.1)",width:"100%",height:"100%",maxWidth:"1200px",maxHeight:"95vh",boxSizing:"border-box",overflow:"hidden"},children:[(0,l.jsxs)("div",{style:{flexGrow:1,marginRight:"20px",display:"flex",flexDirection:"column",alignItems:"center",overflowY:"auto",padding:"10px"},children:[(0,l.jsx)("h1",{style:{textAlign:"center",fontSize:"1.5em",color:"#2e7d32",marginBottom:"5px",flexShrink:0},children:"创设氧气浓度适宜生物多样化的环境"}),(0,l.jsxs)("h2",{style:{textAlign:"center",fontSize:"1.2em",color:"#4caf50",marginTop:"0",marginBottom:"10px",flexShrink:0},children:["当前关卡：",t.currentLevel]}),3===t.currentLevel&&(0,l.jsxs)("h3",{style:w,children:["倒计时: ",t.timeLeft,"s"]}),(0,l.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(".concat(4,", 80px)"),gridTemplateRows:"repeat(".concat(5,", 80px)"),gap:"5px",border:"2px solid #a5d6a7",margin:"20px auto",backgroundColor:"#c8e6c9",borderRadius:"8px",padding:"5px"},children:t.grid.flat().map(e=>(0,l.jsx)("div",{onClick:()=>m(Math.floor(e.id/4),e.id%4),style:{...v,backgroundColor:e.isFertile?"fire"===e.content?"#ffcc80":"#D2B48C":"#E0C9A6",boxShadow:d.includes(e.id)?"0 0 5px 2px yellow":"none"},title:e.content||"空地",onMouseEnter:e=>e.currentTarget.style.transform="scale(1.05)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:y(e)},e.id))}),(0,l.jsxs)("div",{style:{textAlign:"center",marginTop:"20px",flexShrink:0},children:[(0,l.jsx)("button",{onClick:()=>{s.length>0&&(n(s[s.length-1]),c(s.slice(0,-1)),u([]),f("操作已撤销"))},style:b,children:"撤销"}),(0,l.jsx)("button",{onClick:()=>{if(h(),t.currentLevel<3){let l=t.currentLevel+1;f("进入关卡 ".concat(l)),n(t=>({...t,currentLevel:l,grid:e(),oxygenLevel:0,plantCount:0,humanCount:0,tigerCount:0,woodCount:0,timeLeft:120,isGameOver:!1,messages:["欢迎来到关卡 ".concat(l)]})),u([]),x(e())}else f("已经是最后一关了！或尝试重新开始当前关卡。"),n(t=>({...t,grid:e(),oxygenLevel:0,plantCount:0,humanCount:0,tigerCount:0,woodCount:0,timeLeft:120,isGameOver:!1,messages:["重新开始关卡 ".concat(t.currentLevel)]})),u([]),x(e())},style:{...b,marginLeft:"10px"},children:3===t.currentLevel?"重新开始当前关卡":"进入下一关"})]})]}),(0,l.jsxs)("div",{style:{width:"300px",paddingLeft:"20px",borderLeft:"1px solid #bcaaa4",display:"flex",flexDirection:"column",overflowY:"auto",flexShrink:0,padding:"10px"},children:[(0,l.jsx)("h3",{style:L,children:"可选生物/物品:"}),(0,l.jsx)("div",{style:{marginBottom:"15px",flexShrink:0},children:[{name:"plant",label:"植物 \uD83C\uDF3F"},{name:"human",label:"人 \uD83E\uDDD1"},{name:"tiger",label:"老虎 \uD83D\uDC05"}].map(e=>(0,l.jsx)("button",{onClick:()=>p(e.name),style:{padding:"10px",margin:"5px 0",width:"100%",fontSize:"1em",cursor:"pointer",backgroundColor:r===e.name?"#a5d6a7":"#fff",border:"1px solid #a5d6a7",borderRadius:"5px",color:"#333",textAlign:"left"},children:e.label},e.name))}),(0,l.jsx)("h3",{style:L,children:"状态显示:"}),(0,l.jsxs)("div",{style:{marginBottom:"10px",flexShrink:0},children:[(0,l.jsxs)("p",{style:C,children:["氧气浓度: ",t.oxygenLevel,"%"]}),(0,l.jsx)("div",{style:{width:"100%",backgroundColor:"#ddd",borderRadius:"3px",height:"20px",overflow:"hidden"},children:(0,l.jsx)("div",{style:{width:"".concat(t.oxygenLevel,"%"),backgroundColor:t.oxygenLevel<20||t.oxygenLevel>30?"#f44336":"#4caf50",height:"100%",borderRadius:"3px",transition:"width 0.5s ease-in-out"}})})]}),(0,l.jsxs)("p",{style:C,children:["植物数量: ",t.plantCount," \uD83C\uDF3F"]}),(0,l.jsxs)("p",{style:C,children:["人类数量: ",t.humanCount," \uD83E\uDDD1"]}),(0,l.jsxs)("p",{style:C,children:["老虎数量: ",t.tigerCount," \uD83D\uDC05"]}),(0,l.jsxs)("p",{style:C,children:["木头数量: ",t.woodCount," \uD83E\uDEB5"]}),(0,l.jsx)("h3",{style:L,children:"信息提示:"}),(0,l.jsx)("textarea",{readOnly:!0,value:t.messages.join("\n"),style:{width:"100%",minHeight:"100px",flexGrow:1,border:"1px solid #a5d6a7",borderRadius:"5px",padding:"10px",fontSize:"0.9em",backgroundColor:"#f1f8e9",boxSizing:"border-box",resize:"none",color:"black"}})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[685,411,358],()=>t(3662)),_N_E=e.O()}]);