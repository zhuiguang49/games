(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3662:(e,t,n)=>{Promise.resolve().then(n.bind(n,5288))},5288:(e,t,n)=>{"use strict";n.d(t,{default:()=>l});var o=n(2860),r=n(3200);let i=(e,t,n)=>{for(let[o,r]of[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]]){let i=e+o,l=t+r;if(i>=0&&i<5&&l>=0&&l<4&&"tiger"===n[i][l].content)return!0}return!1},l=()=>{let e=()=>[,,,,,].fill(null).map((e,t)=>[,,,,].fill(null).map((e,n)=>({id:4*t+n,content:null,isFertile:!0,owner:null,isDecaying:!1}))),[t,n]=(0,r.useState)({grid:e(),oxygenLevel:0,plantCount:0,humanCount:0,tigerCount:0,woodCount:0,currentLevel:1,timeLeft:120,messages:["欢迎来到生态保护游戏！"],isGameOver:!1}),[l,a]=(0,r.useState)(null),[s,c]=(0,r.useState)([]),[d,u]=(0,r.useState)([]),f=(0,r.useCallback)(e=>{n(t=>({...t,messages:[...t.messages.slice(-5),e]}))},[]),x=(0,r.useCallback)((e,t)=>{let n=t;if(e.flat().filter(e=>"fire"===e.content).length>=2){for(let t=0;t<5;t++)for(let o=0;o<4;o++)if("tiger"===e[t][o].content){let r=0;for(let[n,i]of[[-1,0],[1,0],[0,-1],[0,1]]){let l=t+n,a=o+i;l>=0&&l<5&&a>=0&&a<4&&"fire"===e[l][a].content&&r++}if(r>=2)return e[t][o].content="tiger-dead",e[t][o].isDecaying=!0,n+=" 两团火的热量消灭了一只老虎！"}}return n},[]),g=(0,r.useCallback)(e=>{let t=0,o=0,r=0,i=0,l=0;e.flat().forEach(e=>{"plant"===e.content&&(t++,l+=e.isFertile?10:1),("human"===e.content||"human"===e.owner)&&o++,"tiger"===e.content&&r++,"wood"===e.content&&i++}),l-=5*o,l=Math.max(0,Math.min(100,l)),n(n=>({...n,plantCount:t,humanCount:o,tigerCount:r,woodCount:i,oxygenLevel:l,grid:e}))},[]);(0,r.useEffect)(()=>{let e=t.grid.map(e=>e.map(e=>({...e}))),n=[],o=!1,r=!1;e.flat().forEach(i=>{let l=Math.floor(i.id/4),a=i.id%4;if("human"===i.content)t.oxygenLevel<20&&t.plantCount>0?(n.push("氧气浓度低于20%，人类窒息而亡！"),e[l][a].content="human-dead",e[l][a].isDecaying=!0,o=!0):t.oxygenLevel>70&&(n.push("氧气浓度高于70%，人类因含氧量超标死亡！"),e[l][a].content="human-dead",e[l][a].isDecaying=!0,o=!0);else if(("human-dead"===i.content||"tiger-dead"===i.content)&&i.isDecaying){let t="human-dead"===i.content?"骸骨":"老虎残骸";e[l][a].content=null,e[l][a].isDecaying=!1,o=!0,r||(n.push("一具".concat(t,"风化消失了。")),r=!0)}}),n.length>0&&n.forEach(e=>f(e)),o&&g(e)},[t.oxygenLevel,t.plantCount,t.grid,f,g]),(0,r.useEffect)(()=>{let e;if(3===t.currentLevel&&t.timeLeft>0&&!t.isGameOver)e=setInterval(()=>{n(e=>({...e,timeLeft:e.timeLeft-1}))},1e3);else if(3===t.currentLevel&&0===t.timeLeft&&!t.isGameOver){f("持续降雨，引发洪水，土壤变贫瘠！");let e=t.grid.map(e=>e.map(e=>"fire"!==e.content?{...e,content:null,owner:null,isFertile:!1,isDecaying:!1}:{...e,isFertile:!0}));n(t=>({...t,grid:e,isGameOver:!0,messages:[...t.messages,"3秒后，所有非防火格物品消失，土壤贫瘠化。"],woodCount:0})),g(e)}return()=>clearInterval(e)},[t.currentLevel,t.timeLeft,t.isGameOver,f,g,t.grid]);let m=()=>{c(e=>[...e,JSON.parse(JSON.stringify(t))])},h=(e,n)=>{if(t.isGameOver&&3===t.currentLevel&&0===t.timeLeft){f("洪水过后，请重新开始或选择关卡。");return}m();let o=t.grid.map(e=>e.map(e=>({...e}))),r=o[e][n],s="";if(l){if(null===r.content){if(r.content=l,s="放置了 ".concat("plant"===l?"植物":"human"===l?"人":"老虎"),"human"===l){if(0===t.plantCount&&0===t.oxygenLevel)s="环境中无氧气，人类窒息而亡！",r.content="human-dead",r.isDecaying=!0;else{let e=o.flat().filter(e=>"plant"===e.content);if(e.length>0){let t=e[Math.floor(Math.random()*e.length)];o[Math.floor(t.id/4)][t.id%4].content="plant-dead",s+=", 消耗了一株植物。"}else s+=", 但没有植物可消耗。"}}a(null)}else"human"===l&&"house"===r.content&&null===r.owner?(r.owner="human",s="人住进了房子！",a(null)):s="这个格子已经被占用了！"}else if("plant"===r.content)i(e,n,o)?(r.content="fire",s="植物在老虎的威胁下被点燃了！",3!==t.currentLevel||r.isFertile||(r.isFertile=!0,s+=" 草木灰增加了土壤肥力！"),s=x(o,s)):t.currentLevel>=2?(r.content="wood",s="植物变成了木头！收集4块木头可以建造房子。"):s="点击植物。在第二关及以后，植物可以转化为木头。";else if("wood"===r.content&&t.currentLevel>=2){let e=r.id;if(!d.includes(e)){let t=[...d,e];if(u(t),s="选择了木头 (".concat(t.length,"/4)。"),4===t.length){let e=!1;for(let n=0;n<5;n++){for(let r=0;r<4;r++)if(null===o[n][r].content){o[n][r].content="house",s="4块木头合成了一座房子！",t.forEach(e=>{o[Math.floor(e/4)][e%4].content=null}),e=!0;break}if(e)break}e||(s="没有空地建造房子！"),u([])}}}else"plant-dead"===r.content?(r.content="fire",s="枯叶被点燃，变成了火！",3!==t.currentLevel||r.isFertile||(r.isFertile=!0,s+=" 草木灰增加了土壤肥力！"),s=x(o,s)):s="请先选择一个物品，或点击植物/枯叶进行转化。";s&&f(s);let c=!1;if(t.currentLevel>=2){let e=o.map(e=>e.map(e=>({...e})));for(let t=0;t<5;t++){for(let n=0;n<4;n++)if("tiger"===e[t][n].content){let o=!1;for(let[r,i]of[[-1,0],[1,0],[0,-1],[0,1],[-1,-1],[-1,1],[1,-1],[1,1]]){let l=t+r,a=n+i;if(l>=0&&l<5&&a>=0&&a<4){let r=e[l][a];if("human"===r.content&&!("human"===r.owner&&"house"===e[l][a].content)){e[l][a].content="human-dead",e[l][a].isDecaying=!0,f("老虎在(".concat(t+1,",").concat(n+1,")吃掉了(").concat(l+1,",").concat(a+1,")的人！")),c=!0,o=!0;break}}}if(o)break}if(c)break}if(c){g(e);return}}g(o)},p=e=>{a(e),u([]),f("选择了 ".concat("plant"===e?"植物":"human"===e?"人":"老虎"))},v=e=>"plant"===e.content?"\uD83C\uDF3F":"plant-dead"===e.content?"\uD83C\uDF42":"human"===e.content?"\uD83E\uDDD1":"human-dead"===e.content?"\uD83D\uDC80":"tiger"===e.content?"\uD83D\uDC05":"tiger-dead"===e.content?"☠️":"fire"===e.content?"\uD83D\uDD25":"wood"===e.content?d.includes(e.id)?"\uD83E\uDEB5✨":"\uD83E\uDEB5":"house"===e.content?"human"===e.owner?"\uD83C\uDFE0\uD83E\uDDD1":"\uD83C\uDFE0":"",y={border:"1px solid #a5d6a7",backgroundColor:"#D2B48C",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2.5em",cursor:"pointer",transition:"background-color 0.3s ease, transform 0.1s ease",borderRadius:"4px"},b={padding:"10px 15px",fontSize:"1em",cursor:"pointer",backgroundColor:"#4CAF50",color:"white",border:"none",borderRadius:"5px",margin:"5px"};return(0,o.jsx)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"100vh",width:"100vw",padding:"0px",margin:"0px",boxSizing:"border-box",backgroundColor:"#001f3f"},children:(0,o.jsxs)("div",{style:{display:"flex",flexDirection:"row",backgroundColor:"#e0f2f1",padding:"20px",borderRadius:"10px",boxShadow:"0 4px 8px rgba(0,0,0,0.1)",width:"100%",height:"100%",maxWidth:"1200px",maxHeight:"95vh",boxSizing:"border-box",overflow:"hidden"},children:[(0,o.jsxs)("div",{style:{flexGrow:1,marginRight:"20px",display:"flex",flexDirection:"column",alignItems:"center",overflowY:"auto",padding:"10px"},children:[(0,o.jsx)("h1",{style:{textAlign:"center",fontSize:"1.5em",color:"#2e7d32",marginBottom:"5px",flexShrink:0},children:"创设氧气浓度适宜生物多样化的环境"}),(0,o.jsxs)("h2",{style:{textAlign:"center",fontSize:"1.2em",color:"#4caf50",marginTop:"0",marginBottom:"10px",flexShrink:0},children:["当前关卡：",t.currentLevel]}),3===t.currentLevel&&(0,o.jsxs)("h3",{style:{textAlign:"center",color:t.timeLeft<10?"red":"#f57c00",marginTop:"0",marginBottom:"10px",flexShrink:0},children:["倒计时: ",t.timeLeft,"s"]}),(0,o.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(".concat(4,", 80px)"),gridTemplateRows:"repeat(".concat(5,", 80px)"),gap:"5px",border:"2px solid #a5d6a7",margin:"20px auto",backgroundColor:"#c8e6c9",borderRadius:"8px",padding:"5px"},children:t.grid.flat().map(e=>(0,o.jsx)("div",{onClick:()=>h(Math.floor(e.id/4),e.id%4),style:{...y,backgroundColor:e.isFertile?"fire"===e.content?"#ffcc80":"#D2B48C":"#E0C9A6",boxShadow:d.includes(e.id)?"0 0 5px 2px yellow":"none"},title:e.content||"空地",onMouseEnter:e=>e.currentTarget.style.transform="scale(1.05)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:v(e)},e.id))}),(0,o.jsxs)("div",{style:{textAlign:"center",marginTop:"20px",flexShrink:0},children:[(0,o.jsx)("button",{onClick:()=>{s.length>0&&(n(s[s.length-1]),c(s.slice(0,-1)),u([]),f("操作已撤销"))},style:b,children:"撤销"}),(0,o.jsx)("button",{onClick:()=>{if(m(),t.currentLevel<3){let o=t.currentLevel+1;f("进入关卡 ".concat(o)),n(t=>({...t,currentLevel:o,grid:e(),oxygenLevel:0,plantCount:0,humanCount:0,tigerCount:0,woodCount:0,timeLeft:120,isGameOver:!1,messages:["欢迎来到关卡 ".concat(o)]})),u([]),g(e())}else f("已经是最后一关了！或尝试重新开始当前关卡。"),n(t=>({...t,grid:e(),oxygenLevel:0,plantCount:0,humanCount:0,tigerCount:0,woodCount:0,timeLeft:120,isGameOver:!1,messages:["重新开始关卡 ".concat(t.currentLevel)]})),u([]),g(e())},style:{...b,marginLeft:"10px"},children:3===t.currentLevel?"重新开始":"进入下一关"})]})]}),(0,o.jsxs)("div",{style:{width:"300px",paddingLeft:"20px",borderLeft:"1px solid #bcaaa4",display:"flex",flexDirection:"column",overflowY:"auto",flexShrink:0,padding:"10px"},children:[(0,o.jsx)("h3",{style:{color:"#2e7d32",marginTop:"0",flexShrink:0},children:"可选生物/物品:"}),(0,o.jsx)("div",{style:{marginBottom:"15px",flexShrink:0},children:[{name:"plant",label:"植物 \uD83C\uDF3F"},{name:"human",label:"人 \uD83E\uDDD1"},{name:"tiger",label:"老虎 \uD83D\uDC05"}].map(e=>(0,o.jsx)("button",{onClick:()=>p(e.name),style:{padding:"10px",margin:"5px 0",width:"100%",fontSize:"1em",cursor:"pointer",backgroundColor:l===e.name?"#a5d6a7":"#fff",border:"1px solid #a5d6a7",borderRadius:"5px",color:"#333",textAlign:"left"},children:e.label},e.name))}),(0,o.jsx)("h3",{style:{color:"#2e7d32",marginTop:"15px",flexShrink:0},children:"状态显示:"}),(0,o.jsxs)("div",{style:{marginBottom:"10px",flexShrink:0},children:[(0,o.jsxs)("p",{style:{margin:"5px 0",fontSize:"0.9em"},children:["氧气浓度: ",t.oxygenLevel,"%"]}),(0,o.jsx)("div",{style:{width:"100%",backgroundColor:"#ddd",borderRadius:"3px",height:"20px",overflow:"hidden"},children:(0,o.jsx)("div",{style:{width:"".concat(t.oxygenLevel,"%"),backgroundColor:t.oxygenLevel<20||t.oxygenLevel>70?"#f44336":"#4caf50",height:"100%",borderRadius:"3px",transition:"width 0.5s ease-in-out"}})})]}),(0,o.jsxs)("p",{style:{margin:"5px 0",fontSize:"0.9em",flexShrink:0},children:["植物数量: ",t.plantCount," \uD83C\uDF3F"]}),(0,o.jsxs)("p",{style:{margin:"5px 0",fontSize:"0.9em",flexShrink:0},children:["人类数量: ",t.humanCount," \uD83E\uDDD1"]}),(0,o.jsxs)("p",{style:{margin:"5px 0",fontSize:"0.9em",flexShrink:0},children:["老虎数量: ",t.tigerCount," \uD83D\uDC05"]}),(0,o.jsxs)("p",{style:{margin:"5px 0",fontSize:"0.9em",flexShrink:0},children:["木头数量: ",t.woodCount," \uD83E\uDEB5"]}),(0,o.jsx)("h3",{style:{color:"#2e7d32",marginTop:"15px",flexShrink:0},children:"信息提示:"}),(0,o.jsx)("textarea",{readOnly:!0,value:t.messages.join("\n"),style:{width:"100%",minHeight:"100px",flexGrow:1,border:"1px solid #a5d6a7",borderRadius:"5px",padding:"10px",fontSize:"0.9em",backgroundColor:"#f1f8e9",boxSizing:"border-box",resize:"none"}})]})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[685,411,358],()=>t(3662)),_N_E=e.O()}]);