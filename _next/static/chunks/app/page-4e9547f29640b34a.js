(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3662:(e,t,n)=>{Promise.resolve().then(n.bind(n,5288))},5288:(e,t,n)=>{"use strict";n.d(t,{default:()=>l});var r=n(2860),o=n(3200);let l=()=>{let e=()=>[,,,,,].fill(null).map((e,t)=>[,,,,].fill(null).map((e,n)=>({id:4*t+n,content:null,isFertile:!0,owner:null}))),[t,n]=(0,o.useState)({grid:e(),oxygenLevel:0,plantCount:0,humanCount:0,tigerCount:0,woodCount:0,currentLevel:1,timeLeft:120,messages:["欢迎来到生态保护游戏！"],isGameOver:!1}),[l,i]=(0,o.useState)(null),[a,d]=(0,o.useState)([]),[s,c]=(0,o.useState)([]),u=(0,o.useCallback)(e=>{n(t=>({...t,messages:[...t.messages.slice(-4),e]}))},[]),f=(0,o.useCallback)(e=>{let t=0,r=0,o=0,l=0,i=0;e.flat().forEach(e=>{"plant"===e.content&&(t++,i+=e.isFertile?10:1),("human"===e.content||"human"===e.owner)&&r++,"tiger"===e.content&&o++,"wood"===e.content&&l++}),i-=5*r,i=Math.max(0,i),n(n=>({...n,plantCount:t,humanCount:r,tigerCount:o,woodCount:l,oxygenLevel:i,grid:e}))},[]);(0,o.useEffect)(()=>{let e=t.grid.map(e=>e.map(e=>({...e}))),n=[],r=!1;t.grid.flat().forEach(o=>{let l=Math.floor(o.id/4),i=o.id%4;"human"===o.content&&(t.oxygenLevel<20&&t.oxygenLevel>0?(n.push("氧气浓度低于20%，人类窒息而亡！"),e[l][i].content="human-dead",r=!0):t.oxygenLevel>30&&(n.push("氧气浓度高于30%，人类因含氧量超标死亡！"),e[l][i].content="human-dead",r=!0))}),n.length>0&&n.forEach(e=>u(e)),r&&f(e)},[t.oxygenLevel,t.grid,u,f]),(0,o.useEffect)(()=>{let e;if(3===t.currentLevel&&t.timeLeft>0&&!t.isGameOver)e=setInterval(()=>{n(e=>({...e,timeLeft:e.timeLeft-1}))},1e3);else if(3===t.currentLevel&&0===t.timeLeft&&!t.isGameOver){u("持续降雨，引发洪水，土壤变贫瘠！");let e=t.grid.map(e=>e.map(e=>"fire"!==e.content?{...e,content:null,owner:null,isFertile:!1}:{...e,isFertile:!0}));n(t=>({...t,grid:e,isGameOver:!0,messages:[...t.messages,"3秒后，所有非防火格物品消失，土壤贫瘠化。"],woodCount:0})),f(e)}return()=>clearInterval(e)},[t.currentLevel,t.timeLeft,t.isGameOver,u,f,t.grid]);let p=()=>{d(e=>[...e,JSON.parse(JSON.stringify(t))])},x=(e,n)=>{if(t.isGameOver&&3===t.currentLevel&&0===t.timeLeft){u("洪水过后，请重新开始或选择关卡。");return}p();let r=t.grid.map(e=>e.map(e=>({...e}))),o=r[e][n],a="";if(l){if(null===o.content){if(o.content=l,a="放置了 ".concat("plant"===l?"植物":"human"===l?"人":"老虎"),"plant"===l);else if("human"===l){if(0===t.plantCount&&0===t.oxygenLevel)a="环境中无氧气，人类窒息而亡！",o.content="human-dead";else{let e=r.flat().filter(e=>"plant"===e.content);if(e.length>0){let t=e[0];r[Math.floor(t.id/4)][t.id%4].content="plant-dead",a+=", 消耗了一株植物。"}else a+=", 但没有植物可消耗。"}}i(null)}else"human"===l&&"house"===o.content&&null===o.owner?(o.owner="human",a="人住进了房子！",i(null)):a="这个格子已经被占用了！"}else if("plant"===o.content&&t.currentLevel>=2)o.content="wood",a="植物变成了木头！收集4块木头可以建造房子。";else if("wood"===o.content&&t.currentLevel>=2){let e=o.id;if(!s.includes(e)){let t=[...s,e];if(c(t),a="选择了木头 (".concat(t.length,"/4)。"),4===t.length){let e=!1;for(let n=0;n<5;n++){for(let o=0;o<4;o++)if(null===r[n][o].content){r[n][o].content="house",a="4块木头合成了一座房子！",t.forEach(e=>{r[Math.floor(e/4)][e%4].content=null}),e=!0;break}if(e)break}e||(a="没有空地建造房子！"),c([])}}}else if("plant"===o.content&&t.currentLevel>=2){let l=!1,i=[[-1,0],[1,0],[0,-1],[0,1]];for(let[t,o]of i){let i=e+t,a=n+o;if(i>=0&&i<5&&a>=0&&a<4&&"tiger"===r[i][a].content){l=!0;break}}if(l||3===t.currentLevel){if(o.content="fire",a="植物变成了火！",3!==t.currentLevel||o.isFertile||(o.isFertile=!0,a+=" 草木灰增加了土壤肥力！"),r.flat().filter(e=>"fire"===e.content).length>=2){for(let e=0;e<5;e++)for(let t=0;t<4;t++)if("tiger"===r[e][t].content){let n=0;for(let[o,l]of i){let i=e+o,a=t+l;i>=0&&i<5&&a>=0&&a<4&&"fire"===r[i][a].content&&n++}if(n>=2){r[e][t].content="tiger-dead",a+=" 两团火消灭了一只老虎！";break}}}}else a="植物可以变成木头，或者在老虎旁边/第三关时变成火。"}else a="请先选择一个物品，或点击植物进行转化。";a&&u(a);let d=!1;if(t.currentLevel>=2){let e=r.map(e=>e.map(e=>({...e})));for(let t=0;t<5;t++){for(let n=0;n<4;n++){if("tiger"===e[t][n].content)for(let[r,o]of[[-1,0],[1,0],[0,-1],[0,1]]){let l=t+r,i=n+o;if(l>=0&&l<5&&i>=0&&i<4){let t=e[l][i];if("human"===t.content&&!("human"===t.owner&&"house"===e[l][i].content)){e[l][i].content="human-dead",u("老虎吃掉了一个人！"),d=!0;break}}}if(d)break}if(d)break}if(d){f(e);return}}f(r)},g=e=>{i(e),c([]),u("选择了 ".concat("plant"===e?"植物":"human"===e?"人":"老虎"))},h=e=>"plant"===e.content?"\uD83C\uDF3F":"plant-dead"===e.content?"\uD83C\uDF42":"human"===e.content?"\uD83E\uDDD1":"human-dead"===e.content?"\uD83D\uDC80":"tiger"===e.content?"\uD83D\uDC05":"tiger-dead"===e.content?"☠️":"fire"===e.content?"\uD83D\uDD25":"wood"===e.content?s.includes(e.id)?"\uD83E\uDEB5✨":"\uD83E\uDEB5":"house"===e.content?"human"===e.owner?"\uD83C\uDFE0\uD83E\uDDD1":"\uD83C\uDFE0":"";return(0,r.jsxs)("div",{style:{display:"flex",fontFamily:"Arial, sans-serif",padding:"20px",maxWidth:"1000px",margin:"auto",backgroundColor:"#e8f5e9"},children:[(0,r.jsxs)("div",{style:{flexGrow:1,marginRight:"20px"},children:[(0,r.jsx)("h1",{style:{textAlign:"center",fontSize:"1.5em",color:"#2e7d32"},children:"创设氧气浓度适宜生物多样化的环境"}),(0,r.jsxs)("h2",{style:{textAlign:"center",fontSize:"1.2em",color:"#4caf50"},children:["当前关卡：",t.currentLevel]}),3===t.currentLevel&&(0,r.jsxs)("h3",{style:{textAlign:"center",color:t.timeLeft<10?"red":"#f57c00"},children:["倒计时: ",t.timeLeft,"s"]}),(0,r.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(".concat(4,", 80px)"),gridTemplateRows:"repeat(".concat(5,", 80px)"),gap:"5px",border:"2px solid #a5d6a7",width:"".concat(339,"px"),margin:"20px auto",backgroundColor:"#c8e6c9",borderRadius:"8px",padding:"5px"},children:t.grid.flat().map(e=>(0,r.jsx)("div",{onClick:()=>x(Math.floor(e.id/4),e.id%4),style:{border:"1px solid #a5d6a7",backgroundColor:e.isFertile?"fire"===e.content?"#ffcc80":"#D2B48C":"#E0C9A6",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"2.5em",cursor:"pointer",transition:"background-color 0.3s ease, transform 0.1s ease",borderRadius:"4px",boxShadow:s.includes(e.id)?"0 0 5px 2px yellow":"none"},title:e.content||"空地",onMouseEnter:e=>e.currentTarget.style.transform="scale(1.05)",onMouseLeave:e=>e.currentTarget.style.transform="scale(1)",children:h(e)},e.id))}),(0,r.jsxs)("div",{style:{textAlign:"center",marginBottom:"10px"},children:[(0,r.jsx)("button",{onClick:()=>{a.length>0&&(n(a[a.length-1]),d(a.slice(0,-1)),c([]),u("操作已撤销"))},style:{padding:"10px 15px",marginRight:"10px",fontSize:"1em",cursor:"pointer",backgroundColor:"#ffb74d",border:"none",borderRadius:"5px",color:"white"},children:"撤销"}),t.currentLevel<3&&(0,r.jsx)("button",{onClick:()=>{if(p(),t.currentLevel<3){let r=t.currentLevel+1;u("进入关卡 ".concat(r)),n(t=>({...t,currentLevel:r,grid:e(),oxygenLevel:0,plantCount:0,humanCount:0,tigerCount:0,woodCount:0,timeLeft:120,isGameOver:!1,messages:["欢迎来到关卡 ".concat(r)]})),c([]),f(e())}},style:{padding:"10px 15px",fontSize:"1em",cursor:"pointer",backgroundColor:"#66bb6a",border:"none",borderRadius:"5px",color:"white"},children:"进入下一关"})]})]}),(0,r.jsxs)("div",{style:{width:"300px",borderLeft:"2px solid #a5d6a7",paddingLeft:"20px",backgroundColor:"#f1f8e9",borderRadius:"8px",padding:"15px"},children:[(0,r.jsx)("h3",{style:{color:"#2e7d32"},children:"可选生物/物品:"}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,r.jsx)("button",{onClick:()=>g("plant"),style:{margin:"5px 0",padding:"12px",fontSize:"1.1em",cursor:"pointer",backgroundColor:"plant"===l?"#a5d6a7":"#e8f5e9",border:"1px solid #81c784",borderRadius:"5px"},children:"植物 \uD83C\uDF3F"}),(0,r.jsx)("button",{onClick:()=>g("human"),style:{margin:"5px 0",padding:"12px",fontSize:"1.1em",cursor:"pointer",backgroundColor:"human"===l?"#90caf9":"#e3f2fd",border:"1px solid #64b5f6",borderRadius:"5px"},children:"人 \uD83E\uDDD1"}),t.currentLevel>=2&&(0,r.jsx)("button",{onClick:()=>g("tiger"),style:{margin:"5px 0",padding:"12px",fontSize:"1.1em",cursor:"pointer",backgroundColor:"tiger"===l?"#ef9a9a":"#ffebee",border:"1px solid #e57373",borderRadius:"5px"},children:"老虎 \uD83D\uDC05"})]}),(0,r.jsx)("h3",{style:{marginTop:"20px",color:"#2e7d32"},children:"状态显示:"}),(0,r.jsxs)("p",{children:["氧气浓度: ",t.oxygenLevel,"%"]}),(0,r.jsx)("div",{style:{width:"100%",backgroundColor:"#c8e6c9",borderRadius:"5px",marginBottom:"10px",height:"25px",position:"relative",border:"1px solid #a5d6a7"},children:(0,r.jsxs)("div",{style:{width:"".concat(Math.min(100,Math.max(0,t.oxygenLevel)),"%"),backgroundColor:t.oxygenLevel>=20&&t.oxygenLevel<=30?"#4caf50":0===t.oxygenLevel&&0===t.plantCount?"#c8e6c9":"#f44336",height:"100%",borderRadius:"5px",textAlign:"center",color:"white",lineHeight:"25px",transition:"width 0.5s ease, background-color 0.5s ease"},children:[t.oxygenLevel,"%"]})}),(0,r.jsxs)("p",{children:["植物数量: ",t.plantCount," \uD83C\uDF3F"]}),(0,r.jsxs)("p",{children:["人类数量: ",t.humanCount," \uD83E\uDDD1"]}),t.currentLevel>=2&&(0,r.jsxs)("p",{children:["老虎数量: ",t.tigerCount," \uD83D\uDC05"]}),t.currentLevel>=2&&(0,r.jsxs)("p",{children:["木头数量: ",t.woodCount," \uD83E\uDEB5 (选中: ",s.length,"/4)"]}),(0,r.jsx)("h3",{style:{marginTop:"20px",color:"#2e7d32"},children:"信息提示:"}),(0,r.jsx)("div",{style:{height:"150px",overflowY:"auto",border:"1px solid #a5d6a7",padding:"8px",backgroundColor:"#fff",borderRadius:"4px"},children:t.messages.map((e,t)=>(0,r.jsx)("p",{style:{margin:"0 0 8px 0",fontSize:"0.9em",borderBottom:"1px dashed #c8e6c9",paddingBottom:"5px",color:"#555"},children:e},t))})]})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[685,411,358],()=>t(3662)),_N_E=e.O()}]);